---
title: "@icetype/duckdb API"
description: API reference for the @icetype/duckdb package - DuckDB DDL generation from IceType schemas.
---

# @icetype/duckdb API

The `@icetype/duckdb` package transforms IceType schemas to DuckDB DDL (Data Definition Language) statements. DuckDB is an in-process analytical database ideal for local analytics, data science, and edge computing.

## Installation

```bash
npm install @icetype/duckdb
# or
pnpm add @icetype/duckdb
```

## Quick Start

```typescript
import { parseSchema } from '@icetype/core';
import { DuckDBAdapter, transformToDuckDBDDL } from '@icetype/duckdb';

// Parse an IceType schema
const schema = parseSchema({
  $type: 'User',
  id: 'uuid!',
  email: 'string#',
  name: 'string',
  age: 'int?',
  balance: 'decimal',
  tags: 'string[]',
  createdAt: 'timestamp',
});

// Option 1: Use the adapter directly
const adapter = new DuckDBAdapter();
const ddl = adapter.transform(schema, { ifNotExists: true });
const sql = adapter.serialize(ddl);

// Option 2: Use the convenience function
const sql2 = transformToDuckDBDDL(schema, {
  ifNotExists: true,
  schema: 'analytics',
});

console.log(sql2);
// CREATE TABLE IF NOT EXISTS "analytics"."User" (
//   "$id" VARCHAR NOT NULL,
//   "$type" VARCHAR NOT NULL,
//   "$version" INTEGER NOT NULL DEFAULT 1,
//   "$createdAt" BIGINT NOT NULL,
//   "$updatedAt" BIGINT NOT NULL,
//   "id" UUID NOT NULL,
//   "email" VARCHAR UNIQUE,
//   "name" VARCHAR,
//   "age" INTEGER,
//   "balance" DECIMAL(38, 9),
//   "tags" VARCHAR[],
//   "createdAt" TIMESTAMP,
//   PRIMARY KEY ("$id"),
//   UNIQUE ("email")
// );
```

## DuckDBAdapter Class

The main adapter class that implements the `SchemaAdapter` interface.

### Constructor

```typescript
import { DuckDBAdapter } from '@icetype/duckdb';

const adapter = new DuckDBAdapter();
```

### Properties

| Property | Type | Description |
|----------|------|-------------|
| `name` | `string` | `'duckdb'` - Adapter identifier |
| `version` | `string` | `'0.1.0'` - Adapter version |

### Methods

#### `transform(schema, options?)`

Transforms an IceType schema to a DuckDB DDL structure.

```typescript
const ddl = adapter.transform(schema, {
  ifNotExists: true,
  schema: 'analytics',
  includeSystemFields: true,
});
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schema` | `IceTypeSchema` | Parsed IceType schema |
| `options` | `DuckDBAdapterOptions` | Optional configuration |

**Returns:** `DuckDBDDL`

---

#### `serialize(output)`

Serializes a DuckDB DDL structure to a CREATE TABLE SQL statement.

```typescript
const sql = adapter.serialize(ddl);
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `output` | `DuckDBDDL` | DDL structure to serialize |

**Returns:** `string` - SQL CREATE TABLE statement

---

#### `serializeWithIndexes(ddl)`

Generates DDL including CREATE INDEX statements for indexed columns.

```typescript
const sqlWithIndexes = adapter.serializeWithIndexes(ddl);
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `ddl` | `DuckDBDDL` | DDL structure |

**Returns:** `string` - Full DDL including CREATE INDEX statements

## Convenience Functions

### `createDuckDBAdapter()`

Factory function to create a new DuckDB adapter instance.

```typescript
import { createDuckDBAdapter } from '@icetype/duckdb';

const adapter = createDuckDBAdapter();
```

**Returns:** `DuckDBAdapter`

---

### `transformToDuckDBDDL(schema, options?)`

Transforms an IceType schema directly to a DuckDB CREATE TABLE statement.

```typescript
import { parseSchema } from '@icetype/core';
import { transformToDuckDBDDL } from '@icetype/duckdb';

const schema = parseSchema({
  $type: 'User',
  id: 'uuid!',
  email: 'string#',
});

const sql = transformToDuckDBDDL(schema, { ifNotExists: true });
console.log(sql);
// CREATE TABLE IF NOT EXISTS "User" (
//   ...
// );
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schema` | `IceTypeSchema` | Parsed IceType schema |
| `options` | `DuckDBAdapterOptions` | Optional configuration |

**Returns:** `string` - SQL CREATE TABLE statement

---

### `generateDuckDBDDL(schema, options?)`

Transforms an IceType schema to a DuckDB DDL structure (without serializing to SQL).

```typescript
import { generateDuckDBDDL } from '@icetype/duckdb';

const ddl = generateDuckDBDDL(schema, {
  tableName: 'users',
  schema: 'analytics',
});
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schema` | `IceTypeSchema` | Parsed IceType schema |
| `options` | `DuckDBAdapterOptions` | Optional configuration |

**Returns:** `DuckDBDDL`

## DDL Helper Functions

### `mapIceTypeToDuckDB(iceType)`

Maps an IceType type to its DuckDB equivalent.

```typescript
import { mapIceTypeToDuckDB } from '@icetype/duckdb';

const mapping = mapIceTypeToDuckDB('string');
// { duckdbType: 'VARCHAR' }

const decimalMapping = mapIceTypeToDuckDB('decimal');
// { duckdbType: 'DECIMAL', precision: 38, scale: 9 }
```

---

### `getDuckDBTypeString(mapping, field?)`

Gets the DuckDB type string with precision/scale if applicable.

```typescript
import { getDuckDBTypeString } from '@icetype/duckdb';

const typeStr = getDuckDBTypeString({ duckdbType: 'DECIMAL', precision: 10, scale: 2 });
// 'DECIMAL(10, 2)'
```

---

### `toArrayType(baseType)`

Converts a base DuckDB type to its array equivalent.

```typescript
import { toArrayType } from '@icetype/duckdb';

const arrayType = toArrayType('VARCHAR');
// 'VARCHAR[]'
```

---

### `fieldToDuckDBColumn(name, field)`

Converts an IceType field definition to a DuckDB column definition.

```typescript
import { fieldToDuckDBColumn } from '@icetype/duckdb';
import { parseField } from '@icetype/core';

const field = parseField('string#');
const column = fieldToDuckDBColumn('email', field);
// { name: 'email', type: 'VARCHAR', nullable: false, unique: true }
```

---

### `escapeIdentifier(identifier)`

Escapes a DuckDB identifier (table or column name).

```typescript
import { escapeIdentifier } from '@icetype/duckdb';

const escaped = escapeIdentifier('user');
// '"user"'
```

---

### `serializeDDL(ddl)`

Serializes a complete DDL structure to SQL.

```typescript
import { serializeDDL } from '@icetype/duckdb';

const sql = serializeDDL(ddl);
```

---

### `generateIndexStatements(tableName, schemaName, columns)`

Generates CREATE INDEX statements for indexed columns.

```typescript
import { generateIndexStatements } from '@icetype/duckdb';

const indexes = generateIndexStatements('users', 'analytics', columns);
// ['CREATE INDEX "idx_users_email" ON "analytics"."users" ("email");']
```

## Options Reference

### `DuckDBAdapterOptions`

Options for the DuckDB adapter.

```typescript
interface DuckDBAdapterOptions {
  // Override the table name (defaults to schema name)
  tableName?: string;

  // DuckDB schema name (defaults to 'main')
  schema?: string;

  // Add IF NOT EXISTS clause
  ifNotExists?: boolean;

  // Include system fields ($id, $type, $version, $createdAt, $updatedAt)
  includeSystemFields?: boolean;  // default: true

  // Create as a temporary table
  temporary?: boolean;
}
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `tableName` | `string` | Schema name | Override the generated table name |
| `schema` | `string` | `undefined` | DuckDB schema (e.g., `'main'`, `'analytics'`) |
| `ifNotExists` | `boolean` | `undefined` | Add `IF NOT EXISTS` clause |
| `includeSystemFields` | `boolean` | `true` | Include IceType system columns |
| `temporary` | `boolean` | `undefined` | Create a temporary table |

## DuckDB-Specific Features

### Temporary Tables

Create temporary tables that exist only for the duration of the connection:

```typescript
const sql = transformToDuckDBDDL(schema, {
  temporary: true,
});
// CREATE TEMPORARY TABLE "User" (
//   ...
// );
```

### Schema Support

DuckDB supports schemas for organizing tables:

```typescript
const sql = transformToDuckDBDDL(schema, {
  schema: 'analytics',
  ifNotExists: true,
});
// CREATE TABLE IF NOT EXISTS "analytics"."User" (
//   ...
// );
```

### Parquet Integration

DuckDB excels at reading/writing Parquet files. Use IceType schemas to define your table structure, then leverage DuckDB's native Parquet support:

```typescript
const ddl = transformToDuckDBDDL(schema, { ifNotExists: true });

// In your DuckDB queries:
// COPY users TO 'users.parquet' (FORMAT PARQUET);
// CREATE TABLE users AS SELECT * FROM 'users.parquet';
```

### Analytics Capabilities

DuckDB is designed for OLAP workloads. IceType schemas can define analytics tables:

```typescript
const schema = parseSchema({
  $type: 'EventMetrics',
  $index: [['date', 'event_type']],
  date: 'date!',
  event_type: 'string!',
  user_count: 'long',
  total_value: 'decimal',
  avg_duration: 'double',
});

const ddl = transformToDuckDBDDL(schema, {
  schema: 'analytics',
});
```

## Type Mappings

The following table shows how IceType types map to DuckDB types:

| IceType | DuckDB | Notes |
|---------|--------|-------|
| `string` | `VARCHAR` | Variable-length string |
| `text` | `VARCHAR` | Alias for string |
| `int` | `INTEGER` | 32-bit signed integer |
| `long` | `BIGINT` | 64-bit signed integer |
| `bigint` | `BIGINT` | Alias for long |
| `float` | `REAL` | 32-bit floating point |
| `double` | `DOUBLE` | 64-bit floating point |
| `bool` | `BOOLEAN` | True/false |
| `boolean` | `BOOLEAN` | Alias for bool |
| `uuid` | `UUID` | UUID type |
| `timestamp` | `TIMESTAMP` | Date and time |
| `timestamptz` | `TIMESTAMPTZ` | Date and time with timezone |
| `date` | `DATE` | Date only |
| `time` | `TIME` | Time only |
| `json` | `JSON` | JSON type |
| `binary` | `BLOB` | Binary data |
| `decimal` | `DECIMAL(38, 9)` | High-precision decimal |

### Array Types

IceType arrays are mapped to DuckDB array types:

```typescript
// IceType -> DuckDB
'string[]'  -> 'VARCHAR[]'
'int[]'     -> 'INTEGER[]'
'uuid[]'    -> 'UUID[]'
```

### DuckDB Native Types

DuckDB also supports additional types not directly mapped from IceType:

- `HUGEINT` - 128-bit integer
- `TINYINT` - 8-bit integer
- `SMALLINT` - 16-bit integer
- `INTERVAL` - Time interval

## Types

### `DuckDBDDL`

The DDL structure containing all information for table creation.

```typescript
interface DuckDBDDL {
  tableName: string;
  schemaName?: string;
  columns: DuckDBColumn[];
  primaryKey?: string[];
  uniqueConstraints?: string[][];
  temporary?: boolean;
  ifNotExists?: boolean;
}
```

### `DuckDBColumn`

Column definition for DDL generation.

```typescript
interface DuckDBColumn {
  name: string;
  type: string;
  nullable: boolean;
  default?: string;
  primaryKey?: boolean;
  unique?: boolean;
  precision?: number;
  scale?: number;
}
```

### `DuckDBType`

Union of DuckDB native data types.

```typescript
type DuckDBType =
  | 'VARCHAR'
  | 'TEXT'
  | 'INTEGER'
  | 'BIGINT'
  | 'SMALLINT'
  | 'TINYINT'
  | 'REAL'
  | 'FLOAT'
  | 'DOUBLE'
  | 'BOOLEAN'
  | 'UUID'
  | 'TIMESTAMP'
  | 'TIMESTAMPTZ'
  | 'DATE'
  | 'TIME'
  | 'JSON'
  | 'BLOB'
  | 'DECIMAL'
  | 'HUGEINT'
  | 'INTERVAL';
```

## System Columns

When `includeSystemFields` is `true` (the default), the following system columns are added:

| Column | Type | Description |
|--------|------|-------------|
| `$id` | `VARCHAR NOT NULL` | Primary key identifier |
| `$type` | `VARCHAR NOT NULL` | Entity type name |
| `$version` | `INTEGER NOT NULL DEFAULT 1` | Optimistic concurrency version |
| `$createdAt` | `BIGINT NOT NULL` | Creation timestamp (epoch ms) |
| `$updatedAt` | `BIGINT NOT NULL` | Last update timestamp (epoch ms) |

## Use Cases

### Local Development

DuckDB is excellent for local development and testing:

```typescript
// Development schema
const schema = parseSchema({
  $type: 'User',
  id: 'uuid!',
  email: 'string#',
  name: 'string',
});

// Create in-memory DuckDB table
const sql = transformToDuckDBDDL(schema, {
  ifNotExists: true,
});
```

### Data Science Workflows

Use IceType schemas to define data structures for analysis:

```typescript
const schema = parseSchema({
  $type: 'SalesData',
  date: 'date!',
  product_id: 'string!',
  region: 'string!',
  units_sold: 'int',
  revenue: 'decimal',
  cost: 'decimal',
});

const ddl = transformToDuckDBDDL(schema, {
  schema: 'sales',
});
```

### Edge Analytics

DuckDB's embedded nature makes it ideal for edge computing:

```typescript
const schema = parseSchema({
  $type: 'SensorReading',
  timestamp: 'timestamp!',
  device_id: 'string!',
  temperature: 'double',
  humidity: 'double',
  pressure: 'double',
});

const ddl = transformToDuckDBDDL(schema, {
  ifNotExists: true,
  temporary: true,  // Temporary for processing
});
```
