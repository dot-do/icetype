---
title: "@icetype/drizzle API"
description: API reference for the @icetype/drizzle package - bidirectional conversion between IceType schemas and Drizzle ORM.
---

# @icetype/drizzle API

The `@icetype/drizzle` package provides bidirectional conversion between IceType schemas and Drizzle ORM schema files. Export IceType schemas to Drizzle, or import existing Drizzle schemas into IceType.

## Installation

```bash
npm install @icetype/drizzle
# or
pnpm add @icetype/drizzle
```

## Overview

The drizzle package provides:

- **Export to Drizzle** - Transform IceType schemas to Drizzle ORM TypeScript files
- **Import from Drizzle** - Parse existing Drizzle schema files into IceType schemas
- **Multi-dialect Support** - PostgreSQL, MySQL, and SQLite
- **Type-safe Output** - Generated code includes TypeScript type inference

## Quick Start

### Export to Drizzle

```typescript
import { parseSchema } from '@icetype/core';
import { DrizzleAdapter, transformToDrizzle } from '@icetype/drizzle';

// Define an IceType schema
const schema = parseSchema({
  $type: 'User',
  id: 'uuid!',
  email: 'string#',
  name: 'string',
  age: 'int?',
  createdAt: 'timestamp',
});

// Option 1: Use the adapter directly
const adapter = new DrizzleAdapter();
const drizzleSchema = adapter.transform(schema, { dialect: 'pg' });
const code = adapter.serialize(drizzleSchema);

// Option 2: Use the convenience function
const code2 = transformToDrizzle(schema, { dialect: 'pg' });

console.log(code2);
```

**Generated Output:**

```typescript
/**
 * Drizzle ORM Schema
 *
 * Generated by @icetype/drizzle
 *
 * Dialect: pg
 */

import { integer, pgTable, timestamp, uuid, varchar } from 'drizzle-orm/pg-core';

export const user = pgTable('user', {
  id: uuid('id').primaryKey().notNull(),
  email: varchar('email', { length: 255 }).notNull().unique(),
  name: varchar('name', { length: 255 }),
  age: integer('age'),
  createdAt: timestamp('createdAt'),
});

export type User = typeof user.$inferSelect;
export type NewUser = typeof user.$inferInsert;
```

### Import from Drizzle

```typescript
import { parseDrizzleSchema, parseDrizzleFile } from '@icetype/drizzle';

// Parse from string
const code = `
  import { pgTable, varchar, uuid, integer } from 'drizzle-orm/pg-core';

  export const users = pgTable('users', {
    id: uuid('id').primaryKey().notNull(),
    email: varchar('email', { length: 255 }).notNull().unique(),
    name: varchar('name', { length: 255 }),
    age: integer('age'),
  });
`;

const schemas = parseDrizzleSchema(code);
console.log(schemas[0].name); // 'User'
console.log(schemas[0].fields.get('email')); // { name: 'email', type: 'string', ... }

// Parse from file
const schemasFromFile = await parseDrizzleFile('./schema.ts');
```

## DrizzleAdapter Class

The main adapter class that implements the `SchemaAdapter` interface for transforming IceType schemas to Drizzle.

### Constructor

```typescript
import { DrizzleAdapter } from '@icetype/drizzle';

const adapter = new DrizzleAdapter();
```

### Properties

| Property | Type | Value |
|----------|------|-------|
| `name` | `string` | `'drizzle'` |
| `version` | `string` | `'0.1.0'` |

### Methods

#### `transform(schema, options?)`

Transforms an IceType schema to a Drizzle schema structure.

```typescript
const drizzleSchema = adapter.transform(schema, {
  dialect: 'pg',
  camelCase: true,
  includeSystemFields: false,
});
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schema` | `IceTypeSchema` | Parsed IceType schema |
| `options` | `DrizzleAdapterOptions` | Optional configuration |

**Returns:** `DrizzleSchema`

---

#### `serialize(output)`

Serializes a Drizzle schema structure to TypeScript code.

```typescript
const code = adapter.serialize(drizzleSchema);
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `output` | `DrizzleSchema` | Drizzle schema structure |

**Returns:** `string` - Generated TypeScript code

## Export Functions

### `transformToDrizzle(schema, options?)`

Transforms an IceType schema directly to Drizzle TypeScript code.

```typescript
import { parseSchema } from '@icetype/core';
import { transformToDrizzle } from '@icetype/drizzle';

const schema = parseSchema({
  $type: 'Product',
  id: 'uuid!',
  name: 'string!',
  price: 'decimal',
  inStock: 'bool',
});

const code = transformToDrizzle(schema, { dialect: 'mysql' });
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schema` | `IceTypeSchema` | Parsed IceType schema |
| `options` | `DrizzleAdapterOptions` | Optional configuration |

**Returns:** `string` - Generated TypeScript code

---

### `generateDrizzleSchema(schema, options?)`

Transforms an IceType schema to a Drizzle schema structure (without serializing).

```typescript
import { generateDrizzleSchema } from '@icetype/drizzle';

const drizzleSchema = generateDrizzleSchema(schema, {
  dialect: 'sqlite',
  tableName: 'products',
});

// Access the structured output
console.log(drizzleSchema.tables[0].columns);
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schema` | `IceTypeSchema` | Parsed IceType schema |
| `options` | `DrizzleAdapterOptions` | Optional configuration |

**Returns:** `DrizzleSchema`

---

### `transformSchemasToDrizzle(schemas, options?)`

Transforms multiple IceType schemas to a single Drizzle schema file.

```typescript
import { parseSchema } from '@icetype/core';
import { transformSchemasToDrizzle } from '@icetype/drizzle';

const userSchema = parseSchema({ $type: 'User', id: 'uuid!', name: 'string' });
const postSchema = parseSchema({ $type: 'Post', id: 'uuid!', title: 'string!' });

const code = transformSchemasToDrizzle([userSchema, postSchema], { dialect: 'pg' });
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `schemas` | `IceTypeSchema[]` | Array of IceType schemas |
| `options` | `DrizzleAdapterOptions` | Optional configuration |

**Returns:** `string` - Generated TypeScript code with all tables

---

### `createDrizzleAdapter()`

Factory function to create a new Drizzle adapter instance.

```typescript
import { createDrizzleAdapter } from '@icetype/drizzle';

const adapter = createDrizzleAdapter();
```

**Returns:** `DrizzleAdapter`

## Import Functions

### `parseDrizzleSchema(code, options?)`

Parses Drizzle schema code and converts to IceType schemas.

```typescript
import { parseDrizzleSchema } from '@icetype/drizzle';

const code = `
  import { pgTable, varchar, uuid } from 'drizzle-orm/pg-core';

  export const users = pgTable('users', {
    id: uuid('id').primaryKey().notNull(),
    email: varchar('email', { length: 255 }).notNull().unique(),
  });

  export const posts = pgTable('posts', {
    id: uuid('id').primaryKey().notNull(),
    title: varchar('title', { length: 255 }).notNull(),
  });
`;

const schemas = parseDrizzleSchema(code);
// Returns: [IceTypeSchema for User, IceTypeSchema for Post]
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `code` | `string` | TypeScript code containing Drizzle schema definitions |
| `options` | `DrizzleImportOptions` | Optional import configuration |

**Returns:** `IceTypeSchema[]`

---

### `parseDrizzleFile(filePath, options?)`

Parses a Drizzle schema file and converts to IceType schemas.

```typescript
import { parseDrizzleFile } from '@icetype/drizzle';

const schemas = await parseDrizzleFile('./drizzle/schema.ts');

for (const schema of schemas) {
  console.log(`Found table: ${schema.name}`);
  for (const [name, field] of schema.fields) {
    console.log(`  - ${name}: ${field.type}`);
  }
}
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `filePath` | `string` | Path to the TypeScript file |
| `options` | `DrizzleImportOptions` | Optional import configuration |

**Returns:** `Promise<IceTypeSchema[]>`

---

### `parseRawTables(code)`

Parses raw table definitions from Drizzle code (helper for testing).

```typescript
import { parseRawTables } from '@icetype/drizzle';

const tables = parseRawTables(code);
// Returns: ParsedDrizzleTable[]
```

---

### `getIceTypeFromDrizzle(drizzleType)`

Maps a Drizzle type function name to the corresponding IceType.

```typescript
import { getIceTypeFromDrizzle } from '@icetype/drizzle';

getIceTypeFromDrizzle('varchar');  // 'string'
getIceTypeFromDrizzle('integer');  // 'int'
getIceTypeFromDrizzle('uuid');     // 'uuid'
getIceTypeFromDrizzle('boolean');  // 'bool'
getIceTypeFromDrizzle('jsonb');    // 'json'
```

---

### `detectDialect(code)`

Detects the dialect from import statements in the code.

```typescript
import { detectDialect } from '@icetype/drizzle';

const dialect = detectDialect(`import { pgTable } from 'drizzle-orm/pg-core';`);
// Returns: 'pg'
```

## Type Mappings

### IceType to Drizzle (by Dialect)

| IceType | PostgreSQL | MySQL | SQLite |
|---------|------------|-------|--------|
| `string` | `varchar` | `varchar` | `text` |
| `text` | `text` | `text` | `text` |
| `varchar` | `varchar` | `varchar` | `text` |
| `char` | `char` | `char` | `text` |
| `int` | `integer` | `int` | `integer` |
| `long` | `bigint` | `bigint` | `integer` |
| `bigint` | `bigint` | `bigint` | `integer` |
| `smallint` | `smallint` | `smallint` | `integer` |
| `float` | `real` | `float` | `real` |
| `double` | `doublePrecision` | `double` | `real` |
| `decimal` | `decimal` | `decimal` | `real` |
| `numeric` | `numeric` | `decimal` | `real` |
| `bool` | `boolean` | `boolean` | `integer` |
| `boolean` | `boolean` | `boolean` | `integer` |
| `uuid` | `uuid` | `varchar` | `text` |
| `serial` | `serial` | `serial` | `integer` |
| `bigserial` | `bigserial` | `bigint` | `integer` |
| `timestamp` | `timestamp` | `timestamp` | `text` |
| `timestamptz` | `timestamp` | `timestamp` | `text` |
| `date` | `date` | `date` | `text` |
| `time` | `time` | `time` | `text` |
| `interval` | `interval` | `varchar` | `text` |
| `json` | `json` | `json` | `text` |
| `jsonb` | `jsonb` | `json` | `text` |
| `binary` | `bytea` | `blob` | `blob` |
| `bytea` | `bytea` | `blob` | `blob` |
| `blob` | `bytea` | `blob` | `blob` |

### Drizzle to IceType (Import)

| Drizzle Type | IceType |
|--------------|---------|
| `varchar` | `string` |
| `text` | `text` |
| `char` | `string` |
| `integer`, `int` | `int` |
| `smallint` | `int` |
| `bigint` | `long` |
| `serial`, `bigserial` | `int`, `long` |
| `real`, `float` | `float` |
| `doublePrecision`, `double` | `double` |
| `decimal`, `numeric` | `decimal` |
| `boolean` | `bool` |
| `uuid` | `uuid` |
| `timestamp` | `timestamp` |
| `date` | `date` |
| `time` | `time` |
| `json`, `jsonb` | `json` |
| `bytea`, `blob` | `binary` |

## Dialect Support

### PostgreSQL (`pg`)

```typescript
const code = transformToDrizzle(schema, { dialect: 'pg' });
```

**Import Path:** `drizzle-orm/pg-core`

**Table Function:** `pgTable`

**Features:**
- Native UUID support
- JSONB for efficient JSON storage
- Array types (`text[]`, `integer[]`, etc.)
- Timestamp with timezone

---

### MySQL (`mysql`)

```typescript
const code = transformToDrizzle(schema, { dialect: 'mysql' });
```

**Import Path:** `drizzle-orm/mysql-core`

**Table Function:** `mysqlTable`

**Features:**
- UUID stored as `varchar(36)`
- JSON support
- Various integer types

---

### SQLite (`sqlite`)

```typescript
const code = transformToDrizzle(schema, { dialect: 'sqlite' });
```

**Import Path:** `drizzle-orm/sqlite-core`

**Table Function:** `sqliteTable`

**Features:**
- Text-based storage for strings, UUIDs, dates
- Integer for booleans (0/1)
- Blob for binary data

## Options Reference

### `DrizzleAdapterOptions`

Options for exporting IceType schemas to Drizzle.

```typescript
interface DrizzleAdapterOptions {
  // SQL dialect to generate for
  // @default 'pg'
  dialect?: 'pg' | 'mysql' | 'sqlite';

  // Include system fields ($id, $type, $createdAt, $updatedAt)
  // @default false
  includeSystemFields?: boolean;

  // Use camelCase for column names in generated code
  // When true, 'user_name' becomes 'userName' in code
  // @default true
  camelCase?: boolean;

  // Custom table name (overrides schema name)
  tableName?: string;

  // Database schema name (PostgreSQL only)
  schema?: string;

  // Add .notNull() for required fields
  // @default true
  enforceNotNull?: boolean;
}
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `dialect` | `'pg' \| 'mysql' \| 'sqlite'` | `'pg'` | Target SQL dialect |
| `includeSystemFields` | `boolean` | `false` | Include IceType system columns |
| `camelCase` | `boolean` | `true` | Convert column names to camelCase |
| `tableName` | `string` | Schema name (snake_case) | Override table name |
| `schema` | `string` | `undefined` | PostgreSQL schema name |
| `enforceNotNull` | `boolean` | `true` | Apply `.notNull()` to required fields |

---

### `DrizzleImportOptions`

Options for importing Drizzle schemas to IceType.

```typescript
interface DrizzleImportOptions {
  // Inferred dialect (auto-detected if not specified)
  dialect?: 'pg' | 'mysql' | 'sqlite';

  // Convert snake_case column names to camelCase field names
  // @default true
  camelCase?: boolean;
}
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `dialect` | `'pg' \| 'mysql' \| 'sqlite'` | Auto-detected | Dialect hint for type mapping |
| `camelCase` | `boolean` | `true` | Convert snake_case to camelCase |

## Generated Code Examples

### PostgreSQL Schema

**Input IceType:**

```typescript
const schema = parseSchema({
  $type: 'Product',
  id: 'uuid!',
  name: 'string!',
  description: 'text?',
  price: 'decimal',
  quantity: 'int',
  tags: 'string[]',
  metadata: 'json?',
  createdAt: 'timestamp',
});
```

**Output Drizzle (PostgreSQL):**

```typescript
/**
 * Drizzle ORM Schema
 *
 * Generated by @icetype/drizzle
 *
 * Dialect: pg
 */

import { decimal, integer, json, pgTable, text, timestamp, uuid, varchar } from 'drizzle-orm/pg-core';

export const product = pgTable('product', {
  id: uuid('id').primaryKey().notNull(),
  name: varchar('name', { length: 255 }).notNull(),
  description: text('description'),
  price: decimal('price', { precision: 38, scale: 9 }),
  quantity: integer('quantity').notNull(),
  tags: varchar('tags', { length: 255 }).array(),
  metadata: json('metadata'),
  createdAt: timestamp('createdAt').notNull(),
});

export type Product = typeof product.$inferSelect;
export type NewProduct = typeof product.$inferInsert;
```

### MySQL Schema

**Output Drizzle (MySQL):**

```typescript
/**
 * Drizzle ORM Schema
 *
 * Generated by @icetype/drizzle
 *
 * Dialect: mysql
 */

import { decimal, int, json, mysqlTable, text, timestamp, varchar } from 'drizzle-orm/mysql-core';

export const product = mysqlTable('product', {
  id: varchar('id', { length: 36 }).primaryKey().notNull(),
  name: varchar('name', { length: 255 }).notNull(),
  description: text('description'),
  price: decimal('price', { precision: 38, scale: 9 }),
  quantity: int('quantity').notNull(),
  tags: varchar('tags', { length: 255 }),
  metadata: json('metadata'),
  createdAt: timestamp('createdAt').notNull(),
});

export type Product = typeof product.$inferSelect;
export type NewProduct = typeof product.$inferInsert;
```

### SQLite Schema

**Output Drizzle (SQLite):**

```typescript
/**
 * Drizzle ORM Schema
 *
 * Generated by @icetype/drizzle
 *
 * Dialect: sqlite
 */

import { integer, real, sqliteTable, text } from 'drizzle-orm/sqlite-core';

export const product = sqliteTable('product', {
  id: text('id').primaryKey().notNull(),
  name: text('name').notNull(),
  description: text('description'),
  price: real('price'),
  quantity: integer('quantity').notNull(),
  tags: text('tags'),
  metadata: text('metadata'),
  createdAt: text('createdAt').notNull(),
});

export type Product = typeof product.$inferSelect;
export type NewProduct = typeof product.$inferInsert;
```

## CLI Usage

### Export to Drizzle

```bash
# Generate Drizzle schema from IceType definition
npx icetype export --format drizzle --dialect pg schema.ice -o drizzle/schema.ts

# Generate for MySQL
npx icetype export --format drizzle --dialect mysql schema.ice -o drizzle/schema.ts

# Generate for SQLite
npx icetype export --format drizzle --dialect sqlite schema.ice -o drizzle/schema.ts
```

### Import from Drizzle

```bash
# Convert existing Drizzle schema to IceType
npx icetype import --format drizzle drizzle/schema.ts -o schema.ice
```

## Types

### `DrizzleDialect`

Supported Drizzle ORM dialects.

```typescript
type DrizzleDialect = 'pg' | 'mysql' | 'sqlite';
```

### `DrizzleSchema`

Output structure from the adapter transform.

```typescript
interface DrizzleSchema {
  dialect: DrizzleDialect;
  tables: DrizzleTable[];
  imports: DrizzleImport[];
}
```

### `DrizzleTable`

Complete Drizzle table definition.

```typescript
interface DrizzleTable {
  tableName: string;      // Table name (snake_case)
  exportName: string;     // Variable name for export (camelCase)
  columns: DrizzleColumn[];
  indexes: DrizzleIndex[];
  primaryKey?: string[];
}
```

### `DrizzleColumn`

Drizzle column definition.

```typescript
interface DrizzleColumn {
  name: string;                        // Column name
  type: string;                        // Type function (e.g., 'varchar', 'uuid')
  typeParams?: Record<string, unknown>; // Type parameters (length, precision, etc.)
  nullable: boolean;
  primaryKey: boolean;
  unique: boolean;
  defaultValue?: string;               // Default value expression
  isArray: boolean;
  originalName: string;                // Original IceType field name
}
```

### `DrizzleIndex`

Drizzle index definition.

```typescript
interface DrizzleIndex {
  name: string;
  columns: string[];
  unique: boolean;
}
```

### `DrizzleImport`

Import statement for the generated schema file.

```typescript
interface DrizzleImport {
  from: string;    // Module path (e.g., 'drizzle-orm/pg-core')
  names: string[]; // Named imports
}
```

### `ParsedDrizzleColumn`

Parsed column information from Drizzle schema (for import).

```typescript
interface ParsedDrizzleColumn {
  name: string;
  type: string;
  typeParams?: Record<string, unknown>;
  notNull: boolean;
  primaryKey: boolean;
  unique: boolean;
  defaultValue?: string;
  isArray: boolean;
  references?: string;
}
```

### `ParsedDrizzleTable`

Parsed table information from Drizzle schema (for import).

```typescript
interface ParsedDrizzleTable {
  variableName: string;  // Export name
  tableName: string;     // Database table name
  dialect: DrizzleDialect;
  columns: ParsedDrizzleColumn[];
}
```

## Code Generation Utilities

The package exports utility functions for code generation:

### `toCamelCase(str)`

Converts a string to camelCase.

```typescript
import { toCamelCase } from '@icetype/drizzle';

toCamelCase('user_name');  // 'userName'
toCamelCase('first-name'); // 'firstName'
```

### `toSnakeCase(str)`

Converts a string to snake_case.

```typescript
import { toSnakeCase } from '@icetype/drizzle';

toSnakeCase('userName');   // 'user_name'
toSnakeCase('FirstName');  // 'first_name'
```

### `toPascalCase(str)`

Converts a string to PascalCase.

```typescript
import { toPascalCase } from '@icetype/drizzle';

toPascalCase('user_name'); // 'UserName'
toPascalCase('firstName'); // 'FirstName'
```

### `escapeString(str)`

Escapes a string for use in TypeScript code.

```typescript
import { escapeString } from '@icetype/drizzle';

escapeString("user's name"); // "'user\\'s name'"
```

### `validateTableName(name)` / `validateColumnName(name)`

Validates and sanitizes table/column names.

```typescript
import { validateTableName, validateColumnName } from '@icetype/drizzle';

validateTableName('123table');  // 't_123table'
validateColumnName('my-col');   // 'my_col'
```

## Mapping Helpers

### `getDrizzleType(iceType, dialect)`

Gets the Drizzle type function for an IceType.

```typescript
import { getDrizzleType } from '@icetype/drizzle';

getDrizzleType('string', 'pg');    // 'varchar'
getDrizzleType('string', 'sqlite'); // 'text'
getDrizzleType('uuid', 'mysql');   // 'varchar'
```

### `getDrizzleImportPath(dialect)`

Gets the import path for a dialect.

```typescript
import { getDrizzleImportPath } from '@icetype/drizzle';

getDrizzleImportPath('pg');     // 'drizzle-orm/pg-core'
getDrizzleImportPath('mysql');  // 'drizzle-orm/mysql-core'
getDrizzleImportPath('sqlite'); // 'drizzle-orm/sqlite-core'
```

### `getTableFunction(dialect)`

Gets the table function name for a dialect.

```typescript
import { getTableFunction } from '@icetype/drizzle';

getTableFunction('pg');     // 'pgTable'
getTableFunction('mysql');  // 'mysqlTable'
getTableFunction('sqlite'); // 'sqliteTable'
```
